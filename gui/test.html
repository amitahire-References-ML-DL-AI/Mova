<html>
    <head>
        <title>
            Testing Mova
        </title>
        <script src="../dist/Mova.js"></script>
        <style>
            #c1 svg line {
                stroke: navy;
                stroke-width: 3;
            }

            #c1 svg circle {
                stroke: green;
            }
        </style>
    </head>
    <body>
        <div id="head">
            Mova
        </div>
        <div id="c1">
            
        </div>
        <div style="height: 10px"></div>
        <div id="c2">
            
        </div>
        <div style="height: 10px"></div>
        <div id="c3" style="margin-left: 20px;">
            
        </div>

        <div id="c4" style="margin-left: 20px;">
            
        </div>

        <script>
            a = new MovaObject("Slashy");
            a.loadTrack('../movs/Slash_x4_0001KAREN.bvh','bvh', function() {
                // a.tracks[0].isMocap = true;
                a.drawFigureSketch('#c1',a.tracks[0]);

                a.figureSketchConfig.figureScale = 1;
                a.figureSketchConfig.padding = 10;
                a.figureSketchConfig.frameSkip = 5;
                a.drawFigureSketch('#c2',a.tracks[0],500, 1000);
                
                var startTimeI = Date.now();

                window.setInterval(function() {
                    document.getElementById('c3').innerHTML = "";
                    frame = 500+ math.floor((Date.now() - startTimeI)/1000 / a.tracks[0].data.frameTime);                    
                    if (frame>1200){
                        startTimeI=Date.now();
                        frame = 500;
                    }
                    a.drawFigure('#c3',a.tracks[0],frame);
                    
                }, a.tracks[0].data.frameTime * 1000);

                cm = a.tracks[0].data.connectivityMatrix;
                cm2 = [];
                for (i=0;i<cm.length;i++){
                    cm2[i] = [];
                    cm2[i][0] = cm[i][0].jointIndex;
                    cm2[i][1] = cm[i][1].jointIndex;
                }
                var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(cm2));
                var dlAnchorElem = document.getElementById('downloadAnchorElem');
                dlAnchorElem.setAttribute("href",     dataStr     );
                dlAnchorElem.setAttribute("download", "ConnectivityMatrix.json");
                //dlAnchorElem.click();

                move = [];
                for (i=500;i<1200;i++){
                    move[i-500] = a.tracks[0].data.getPositionsAt(i);
                }

                var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(move));
                var dlAnchorElem = document.getElementById('downloadAnchorElem');
                dlAnchorElem.setAttribute("href",     dataStr     );
                dlAnchorElem.setAttribute("download", "Slash.json");
                // dlAnchorElem.click();

            });
            
            b = new MovaObject("Walker");
            b.loadTrack('../movs/MS2_8Walk_M_nopos.bvh','bvh', function() {              
                b.figureSketchConfig.figureScale = 2;
                b.figureSketchConfig.width = 400;
                b.figureSketchConfig.height = 200;

                var startTimeJ = Date.now();

                window.setInterval(function() {
                    document.getElementById('c4').innerHTML = "";
                    frame = math.floor((Date.now() - startTimeJ)/1000 / b.tracks[0].data.frameTime);                    
                    if (frame>b.tracks[0].data.frameCount-1){
                        startTimeJ=Date.now();
                        frame = 0;
                    }
                    b.drawFigure('#c4',b.tracks[0],frame);                    
                    
                }, b.tracks[0].data.frameTime * 1000);
            });


            

        </script>
        <a id="downloadAnchorElem" style="display:none"></a>
    </body>
</html>