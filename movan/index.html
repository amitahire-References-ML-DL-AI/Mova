<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Movement Analayzer</title>
        
        <link href="css/style.css" rel="stylesheet"/>
        <link href="jq/css/smoothness/jquery-ui-1.10.3.custom.css" rel="stylesheet"/>
        
        <style>
			.ui-accordion .ui-accordion-content {
				padding: 1em 0.5em;
				border-top: 0;
				overflow: auto;
			}

			#sideAcaccordion {
				padding: 0px;
				background: none;
			}

			.tooboxTitle {
				padding-left2: 1.2em !important;
				cursor: pointer;
				display2: inline-block;
				float: none;
				top: 0px;
				margin: 0em;
				
				background: transparent;
				border-width: 0px 0px 1px 0px;
				-moz-border-radius: 0px;
				-webkit-border-radius: 0px;
				border-radius: 0px;
			}
			.toolboxTitleText {
				width: 100%;
				height: 2.35em;
				text-align: center;
				background-color: blue;
			}

			#sidebar .ui-tabs-nav {
				background: transparent;
				border-width: 0px 0px 1px 0px;
				-moz-border-radius: 0px;
				-webkit-border-radius: 0px;
				border-radius: 0px;
			}
			#sidebar .ui-tabs-panel {
				margin: 0em 0.2em 0.2em 0.2em;
			}
			
		
			
			
			.ui-tabs .ui-tabs-nav li a img { float: left; margin-right: 5px;margin-top:5px;}

        </style>
        
        <script type="text/javascript" src="d3/d3.v3.js"></script>
        
        <script type="text/javascript" src="js/featureListVis.js"></script>
        <script type="text/javascript" src="js/figureVis.js"></script>
        <script type="text/javascript" src="js/featuresLib.js"></script>
        <script type="text/javascript" src="js/fileTools.js"></script>
        <script type="text/javascript" src="js/figureAnim.js"></script>
        
        
		<script src="jq/jquery-1.9.1.js"></script>
		<script src="jq/jquery-ui-1.10.3.custom.js"></script>
		<script src="jq/jquery.fileupload.js"></script>
		<script src="jq/jquery.iframe-transport.js"></script>
		
		<script>
			$(document).ready(function() {

				$("#maintabs").tabs();
				
				// $("#tabs").click(function(event, ui){
						// console.log(event);
						// if (event.options.selected == 0)
							// playAnim = false;
						// else if (event.options.selected == 1)
							// {playAnim = true;console.log("heee");}
					// }
				// );



				$( "#btnPlay" ).button();
				$( "#btnPlay" ).click(function(event) {
						console.log("clicked");
						playAnim = true;
						$( "#btnPlay" ).button('option', 'label', 'Pause');
				});
					
			
				
			$( "#sideAcaccordion" ).accordion();
			
			$("#sidebar").draggable().tabs({
      		collapsible: true,
  	            active: false 
   			 });
 	 	
    		
    		var setSizes = function () {
    		
    		$("#canCont").height($(document).height()-150-$("#footer").height());
   			$("#featureList").height($("#canCont").height()-290);
   			
   			$("#maintabs").width($(document).width()-$("#legends").width()-60);
   			$("#legends").height($("#canCont").height());
   			};
   			
   			setSizes();
   			
   			$(window).resize( setSizes);
    
    		$("#featureList").scroll(function(){ 
                    $("#figure").scrollLeft($("#featureList").scrollLeft());
               });
                
			
			$( "#btnSave" ).button();
			$( "#btnSave" ).click(function(event) {
						
				});
			
			
			
			
			}); 
		</script>
          
    </head>
    <body>
       
       <div id="header" style="clear:both;">
        <h1 style="float: left;">Movement Analayzer</h1>
        <h4 style="float: right;">Version 0.4</h4>
        </div>
        
        
        <div id="canCont">
        	<div id="maintabs">
				<ul>
					<li><a href="#figure">Figure Sketch</a></li>
					<li><a href="#anim">Animation</a></li>
		
				</ul>
        	<div id="anim"><button id="btnPlay">Play</button></div>
        	<div id="figure"></div>
      		<div id="featureList"></div>
      		</div>
      		<div id="legends"><div style="font-family: Verdana, Arial, sans-serif;font-weight: bold;font-size: 11.5pt;padding-bottom: 5px;"> Legends:</div></div>
        </div>
       
        
        <div id="sidebar">	
        	<ul class="tooboxTitle">
        		<li class="toolboxTitleText"><a href="#sideAcaccordion"><img class="ui-icon ui-icon-circle-triangle-s"/> Toolbox</a></li>
        	</ul>
        	<div id="sideAcaccordion">
        			<h2>Files</h2>
					<div id="filelist" class="sidetab">
					   
					   <div class="sidetabtitle">
							Upload a file:
						</div>
						
					  <input id="fileupload" type="file" name="files[]" data-url="http://cgi.sfu.ca/~oalemi/movan/srv/upload.php" multiple/>
      					
						<div style="margin-top:5px" class="sidetabtitle">
							Select a file:
						</div>
						<select name="drop1" id="fileSelect" size="4" multiple="multiple"
						onchange="loadNew()" style="border:2px solid #ccc; width:200px; height: 120px; overflow-y: scroll;">
							<option value="Punch4.csv" selected="selected">Punch4.csv</option>
							<option value="Float4.csv">Float3.csv</option>
							<option value="Dab1.csv">Dab1.csv</option>
							<option value="Flick1.csv">Flick1.csv</option>
							<option value="Slash4.csv">Slash4.csv</option>
							<option value="Glide3.csv">Glide3.csv</option>
							<option value="Wring2.csv">Wring2.csv</option>

						</select>

					</div>
					
					<h2>Features</h2>
					<div id="features" class="sidetab">
						<div class="sidetabtitle">
							Select features:
						</div>

						<div style="border:2px solid #ccc; width:200px; height: 120px; overflow-y: scroll;">
							<input type="checkbox" id="ch_vel" checked="checked" onchange="reDoFeats()"/>
							Angular Velocity
							<br />
							<input type="checkbox" id="ch_avevel" checked="checked" onchange="reDoFeats()"/>
							AveAngular Velocity
							<br />
							<input type="checkbox" id="ch_accel" checked="checked" onchange="reDoFeats()"/>
							Acacceleration
							<br />
							<input type="checkbox" id="ch_space" checked="checked" onchange="reDoFeats()"/>
							Space (Pathway)
							<br />
							<input type="checkbox" id="ch_weight"  onchange="reDoFeats()"/>
							Effort Weight (fake)
							<br />
							<input type="checkbox" id="ch_time"  onchange="reDoFeats()"/>
							Effort Time (fake)
							<br />
							<input type="checkbox" id="ch_flow"  onchange="reDoFeats()"/>
							Effort Flow (fake)
							<br />
						</div>
						<button type="button">
							Edit Features
						</button>
					</div>
					
					<h2>Visual Controls</h2>
					<div id="controls" class="sidetab">
						<div class="sidetabtitle">
							
						</div>
						Skip Frames:
						<br/>
						5
						<input type="range" id="sldSkips" min="5" max="50" value ="5" width = "100" onchange="reDraw()">
						50
						<br/>
						Padding:
						<br/>
						10
						<input type="range" id="sldPad" min="10" max="70" value ="25" ondrag="reDraw()" onchange="reDraw()">
						70
						<br/>
						<button id="btnSave">Save as SVG</button>
					</div>
				</div>
        </div>
       
        <script type="text/javascript">
        	var gframes = [];
			var gskel = [];
			var grootOffset = [];
			var gpadding = 10;
			
			var inputFPS = 0.0083; //120	
			
			var selectedJoint = 20;
			var skelHeadJoint = 24;
			var frameSkip = 5;

			var selectedFeats = [f_weight, f_space];
				
			function loadNew() {
							

				var moveFile = "movs/"+document.getElementById("fileSelect").value;
				var skelFile = "movs/ecuad1.skel2";

				loadData(moveFile, skelFile, callbackForData);
			}
			
			var callbackForData = function(frames, skel) {
				
				gframes = frames;
				gskel = skel;
				//makeFeats();
				reDraw();
				};

			var animIndex=0;
			var playAnim = false;
			var animSVG = [];
			
			d3.timer(drawFigure, 15);
			
			function reDraw() {
				
				frameSkip = +document.getElementById("sldSkips").value;
				console.log(frameSkip);
				padding = +document.getElementById("sldPad").value;
				
				d3.select("body").select("#figure").selectAll("svg").remove();
				d3.select("body").select("#anim").selectAll("svg").remove();
				
				rootOffset = drawFiguresCanvas(d3.select("body").select("#figure"), gframes, gskel, selectedJoint, frameSkip, padding);
				
				
				animSVG = makeAnim(d3.select("body").select("#anim"), gframes, gskel, selectedJoint, frameSkip, padding);
				
				//playAnim = true;
				
				
				grootOffset = rootOffset;
				gpadding = padding;
				
				makeFeats();
				reDrawFeat();
			} 
			
			function makeFeats() {
				frameSkip = +document.getElementById("sldSkips").value;

				selectedFeats = [];
				f=0;
				
				
				if (document.getElementById("ch_vel").checked)
					{selectedFeats[f]= f_angvel;selectedFeats[f++].data = calcVelocities(gframes, frameSkip,selectedJoint);}
				if (document.getElementById("ch_avevel").checked)
					{selectedFeats[f]= f_aveangvel;selectedFeats[f++].data = calcAveVelocities(gframes, frameSkip,selectedJoint);}
				if (document.getElementById("ch_accel").checked)
					{selectedFeats[f]= f_accel;selectedFeats[f++].data = calcAccel(gframes, frameSkip,selectedJoint);}
				if (document.getElementById("ch_space").checked)
					{selectedFeats[f]= f_space;selectedFeats[f++].data = calcSpace_Pathway(gframes, frameSkip,selectedJoint);}
				if (document.getElementById("ch_weight").checked)
					{selectedFeats[f]= f_weight;selectedFeats[f++].data = makeRandomFeature(gframes, frameSkip);}
				if (document.getElementById("ch_time").checked)
					{selectedFeats[f]= f_time;	selectedFeats[f++].data = makeRandomFeature(gframes, frameSkip);}
				if (document.getElementById("ch_flow").checked)
					{selectedFeats[f]= f_flow;selectedFeats[f++].data = makeRandomFeature(gframes, frameSkip);}
				
					
				
				//for ( i = 0; i < selectedFeats.length; i++)
					//selectedFeats[i].data = makeRandomFeature(gframes, frameSkip);
			}
			
			function reDoFeats() {
				selectedFeats = [];
				f=0;
				
				if (document.getElementById("ch_space").checked)
					selectedFeats[f++]= f_space;
				if (document.getElementById("ch_weight").checked)
					selectedFeats[f++]= f_weight;
				if (document.getElementById("ch_time").checked)
					selectedFeats[f++]= f_time;	
				if (document.getElementById("ch_flow").checked)
					selectedFeats[f++]= f_flow;
				if (document.getElementById("ch_vel").checked)
					selectedFeats[f++]= f_angvel;
				
				makeFeats();
				reDrawFeat();
			}
			
			function reDrawFeat() {
				d3.select("#featureList").selectAll("svg").remove();
				
			
				//console.log(selectedFeats[0]);
				drawFeatureList(d3.select("#featureList"), grootOffset, selectedFeats, gpadding);
			}
			
			
			loadNew();
			
			
        </script>
       
       <script>
       	var mouseWheelEvt = function (e)
			{
    var event = e || window.event;
    if (document.getElementById("canCont").doScroll)
        document.getElementById("canCont").doScroll(event.wheelDelta>0?"left":"right");
    else if ((event.wheelDelta || event.detail) > 0)
        document.getElementById("canCont").scrollLeft -= 20;
    else
        document.getElementById("canCont").scrollLeft += 20;

    return false;
};
if ("onmousewheel" in document.body)
    document.getElementById("canCont").onmousewheel = mouseWheelEvt;
else
    document.getElementById("canCont").addEventListener("DOMMouseScroll", mouseWheelEvt);
       </script>
       
        <script type="text/javascript"> 
        //url: "http://cgi.sfu.ca/~oalemi/movan/srv/upload.php",
           $(function () {
    $('#fileupload').fileupload({
        dataType: 'csv',
        done: function (e, data) {
        	console.log(data);
            $.each(data.result.files, function (index, file) {
                $('<p/>').text(file.name).appendTo(document.body);
            });
        }
    });
});
        </script>
       <div id="footer" style="clear:both;text-align:center;padding-top:20px;"><small>(C) Omid Alemi - Fall 2013</small></div>
    </body>
</html>
